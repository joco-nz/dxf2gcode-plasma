#
# Simple Makefile to pack common tasks into one standard interface
#

.DEFAULT: prepare

# Translation files
SRC_TS = $(wildcard i18n/*.ts)
OBJ_TS = $(patsubst %.ts,%.qm,$(SRC_TS))

# UI files
SRC_UI = dxf2gcode_images.qrc dxf2gcode.ui
OBJ_UI = dxf2gcode_images5_rc.py dxf2gcode_ui5.py

#
# Prepare everything needed for dxf2gcode to run
#
.PHONY: prepare
prepare: $(OBJ_TS) $(OBJ_UI)

.NOTPARALLEL: $(OBJ_TS)
$(OBJ_TS): $(SRC_TS)
	./make_tr.py --no-pylupdate

.NOTPARALLEL: $(OBJ_UI)
$(OBJ_UI): $(SRC_UI)
	./make_py_uic.py

#
# Remove autogenerated files
#
.PHONY: clean
clean:
	rm -f $(OBJ_TS) $(OBJ_UI)
	find . -type d -name __pycache__ -print0 | xargs -0 rm -rf

#
# Prepare for translation with 'linguist' (trs = TRanslation Start).
# Don't forget to run 'make trf' afterwards to remove <location> tags from ts files
# (trf = TRanslation Finish)
#
.PHONY: trs
trs:
	./make_tr.py --keep-ln
	@echo ""
	@echo ">>> Translation files prepared for work."
	@echo ">>> Don't forget to run 'make trf' after you finish translating."

.PHONY: trf
trf:
	./make_tr.py
	@echo ""
	@echo ">>> Translation files are ready for commiting into repository."
